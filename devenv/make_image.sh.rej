***************
*** 23,33 ****
  mkfs.fat -n 'MIKAN OS' -s 2 -f 2 -R 32 -F 32 $DISK_IMG
  
  $DEVENV_DIR/mount_image.sh $DISK_IMG $MOUNT_POINT
- sudo mkdir -p $MOUNT_POINT/EFI/BOOT
- sudo cp $EFI_FILE $MOUNT_POINT/EFI/BOOT/BOOTX64.EFI
  if [ "$ANOTHER_FILE" != "" ]
  then
-     sudo cp $ANOTHER_FILE $MOUNT_POINT/
  fi
  sleep 0.5
- sudo umount $MOUNT_POINT
--- 23,46 ----
  mkfs.fat -n 'MIKAN OS' -s 2 -f 2 -R 32 -F 32 $DISK_IMG
  
  $DEVENV_DIR/mount_image.sh $DISK_IMG $MOUNT_POINT
+ if [ `uname` = 'Darwin' ]; then
+     mkdir -p $MOUNT_POINT/EFI/BOOT
+     cp $EFI_FILE $MOUNT_POINT/EFI/BOOT/BOOTX64.EFI
+ else
+     sudo mkdir -p $MOUNT_POINT/EFI/BOOT
+     sudo cp $EFI_FILE $MOUNT_POINT/EFI/BOOT/BOOTX64.EFI
+ fi
  if [ "$ANOTHER_FILE" != "" ]
  then
+     if [ `uname` = 'Darwin' ]; then
+         cp $ANOTHER_FILE $MOUNT_POINT/
+     else
+         sudo cp $ANOTHER_FILE $MOUNT_POINT/
+     fi
  fi
  sleep 0.5
+ if [ `uname` = 'Darwin' ]; then
+     hdiutil detach $MOUNT_POINT
+ else
+     sudo umount $MOUNT_POINT
+ fi
